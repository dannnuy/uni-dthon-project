Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.52, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Loading QueryBasedDetector model...
Using device: cuda
YOLO detector loaded from: /data/danielsohn0827000/uni-dthon-project/best.pt
CLIP model loaded: openai/clip-vit-base-patch32
EasyOCR loaded.
Model loading complete.
Mapping test queries from /data/danielsohn0827000/unid/open/test/query...
Building query-image map:   0%|          | 0/7530 [00:00<?, ?it/s]Building query-image map:   1%|          | 80/7530 [00:00<00:09, 794.43it/s]Building query-image map:   2%|▏         | 160/7530 [00:00<00:09, 768.16it/s]Building query-image map:   3%|▎         | 237/7530 [00:00<00:09, 763.28it/s]Building query-image map:   4%|▍         | 314/7530 [00:00<00:09, 748.27it/s]Building query-image map:   5%|▌         | 389/7530 [00:00<00:09, 745.63it/s]Building query-image map:   6%|▌         | 468/7530 [00:00<00:09, 759.41it/s]Building query-image map:   7%|▋         | 544/7530 [00:00<00:09, 725.79it/s]Building query-image map:   8%|▊         | 617/7530 [00:00<00:09, 726.18it/s]Building query-image map:   9%|▉         | 690/7530 [00:00<00:09, 699.31it/s]Building query-image map:  10%|█         | 761/7530 [00:01<00:09, 693.46it/s]Building query-image map:  11%|█         | 837/7530 [00:01<00:09, 710.42it/s]Building query-image map:  12%|█▏        | 909/7530 [00:01<00:09, 704.20it/s]Building query-image map:  13%|█▎        | 980/7530 [00:01<00:09, 692.98it/s]Building query-image map:  14%|█▍        | 1050/7530 [00:01<00:09, 684.89it/s]Building query-image map:  15%|█▍        | 1119/7530 [00:01<00:09, 674.24it/s]Building query-image map:  16%|█▌        | 1187/7530 [00:01<00:09, 662.53it/s]Building query-image map:  17%|█▋        | 1254/7530 [00:01<00:09, 640.95it/s]Building query-image map:  18%|█▊        | 1319/7530 [00:01<00:09, 640.61it/s]Building query-image map:  18%|█▊        | 1384/7530 [00:01<00:09, 632.08it/s]Building query-image map:  19%|█▉        | 1449/7530 [00:02<00:09, 636.83it/s]Building query-image map:  20%|██        | 1513/7530 [00:02<00:09, 622.02it/s]Building query-image map:  21%|██        | 1576/7530 [00:02<00:09, 621.45it/s]Building query-image map:  22%|██▏       | 1641/7530 [00:02<00:09, 626.60it/s]Building query-image map:  23%|██▎       | 1704/7530 [00:02<00:09, 625.78it/s]Building query-image map:  23%|██▎       | 1769/7530 [00:02<00:09, 632.44it/s]Building query-image map:  24%|██▍       | 1833/7530 [00:02<00:09, 607.56it/s]Building query-image map:  25%|██▌       | 1894/7530 [00:02<00:09, 595.51it/s]Building query-image map:  26%|██▌       | 1954/7530 [00:02<00:09, 579.75it/s]Building query-image map:  27%|██▋       | 2015/7530 [00:03<00:09, 587.31it/s]Building query-image map:  28%|██▊       | 2076/7530 [00:03<00:09, 592.32it/s]Building query-image map:  28%|██▊       | 2137/7530 [00:03<00:09, 596.06it/s]Building query-image map:  29%|██▉       | 2197/7530 [00:03<00:09, 579.76it/s]Building query-image map:  30%|██▉       | 2256/7530 [00:03<00:09, 580.53it/s]Building query-image map:  31%|███       | 2315/7530 [00:03<00:09, 577.97it/s]Building query-image map:  32%|███▏      | 2374/7530 [00:03<00:08, 579.12it/s]Building query-image map:  32%|███▏      | 2432/7530 [00:03<00:08, 567.05it/s]Building query-image map:  33%|███▎      | 2489/7530 [00:03<00:08, 565.95it/s]Building query-image map:  34%|███▍      | 2546/7530 [00:03<00:08, 554.11it/s]Building query-image map:  35%|███▍      | 2602/7530 [00:04<00:08, 548.63it/s]Building query-image map:  35%|███▌      | 2657/7530 [00:04<00:09, 523.04it/s]Building query-image map:  36%|███▌      | 2714/7530 [00:04<00:08, 535.43it/s]Building query-image map:  37%|███▋      | 2768/7530 [00:04<00:09, 528.68it/s]Building query-image map:  37%|███▋      | 2823/7530 [00:04<00:08, 533.33it/s]Building query-image map:  38%|███▊      | 2877/7530 [00:04<00:08, 531.26it/s]Building query-image map:  39%|███▉      | 2931/7530 [00:04<00:08, 528.08it/s]Building query-image map:  40%|███▉      | 2984/7530 [00:04<00:08, 522.58it/s]Building query-image map:  40%|████      | 3037/7530 [00:04<00:08, 514.48it/s]Building query-image map:  41%|████      | 3089/7530 [00:05<00:08, 504.62it/s]Building query-image map:  42%|████▏     | 3140/7530 [00:05<00:08, 491.52it/s]Building query-image map:  42%|████▏     | 3190/7530 [00:05<00:08, 493.20it/s]Building query-image map:  43%|████▎     | 3240/7530 [00:05<00:08, 487.83it/s]Building query-image map:  44%|████▎     | 3292/7530 [00:05<00:08, 495.22it/s]Building query-image map:  44%|████▍     | 3342/7530 [00:05<00:08, 474.83it/s]Building query-image map:  45%|████▌     | 3391/7530 [00:05<00:08, 478.21it/s]Building query-image map:  46%|████▌     | 3439/7530 [00:05<00:08, 474.21it/s]Building query-image map:  46%|████▋     | 3491/7530 [00:05<00:08, 487.27it/s]Building query-image map:  47%|████▋     | 3540/7530 [00:05<00:08, 488.00it/s]Building query-image map:  48%|████▊     | 3593/7530 [00:06<00:07, 497.89it/s]Building query-image map:  48%|████▊     | 3643/7530 [00:06<00:07, 494.75it/s]Building query-image map:  49%|████▉     | 3693/7530 [00:06<00:08, 476.86it/s]Building query-image map:  50%|████▉     | 3741/7530 [00:06<00:07, 476.73it/s]Building query-image map:  50%|█████     | 3789/7530 [00:06<00:07, 470.24it/s]Building query-image map:  51%|█████     | 3838/7530 [00:06<00:07, 475.49it/s]Building query-image map:  52%|█████▏    | 3888/7530 [00:06<00:07, 481.19it/s]Building query-image map:  52%|█████▏    | 3938/7530 [00:06<00:07, 485.63it/s]Building query-image map:  53%|█████▎    | 3987/7530 [00:06<00:07, 485.53it/s]Building query-image map:  54%|█████▎    | 4036/7530 [00:07<00:07, 483.72it/s]Building query-image map:  54%|█████▍    | 4085/7530 [00:07<00:07, 466.53it/s]Building query-image map:  55%|█████▍    | 4132/7530 [00:07<00:07, 466.83it/s]Building query-image map:  55%|█████▌    | 4179/7530 [00:07<00:07, 463.10it/s]Building query-image map:  56%|█████▌    | 4226/7530 [00:07<00:07, 464.69it/s]Building query-image map:  57%|█████▋    | 4273/7530 [00:07<00:07, 451.46it/s]Building query-image map:  57%|█████▋    | 4319/7530 [00:07<00:07, 441.56it/s]Building query-image map:  58%|█████▊    | 4364/7530 [00:07<00:07, 438.48it/s]Building query-image map:  59%|█████▊    | 4411/7530 [00:07<00:07, 444.39it/s]Building query-image map:  59%|█████▉    | 4457/7530 [00:07<00:06, 447.86it/s]Building query-image map:  60%|█████▉    | 4504/7530 [00:08<00:06, 453.00it/s]Building query-image map:  60%|██████    | 4550/7530 [00:08<00:06, 452.76it/s]Building query-image map:  61%|██████    | 4596/7530 [00:08<00:06, 446.68it/s]Building query-image map:  62%|██████▏   | 4641/7530 [00:08<00:06, 446.33it/s]Building query-image map:  62%|██████▏   | 4686/7530 [00:08<00:06, 425.51it/s]Building query-image map:  63%|██████▎   | 4729/7530 [00:08<00:06, 419.82it/s]Building query-image map:  63%|██████▎   | 4772/7530 [00:08<00:06, 414.40it/s]Building query-image map:  64%|██████▍   | 4814/7530 [00:08<00:06, 413.93it/s]Building query-image map:  64%|██████▍   | 4856/7530 [00:08<00:06, 406.03it/s]Building query-image map:  65%|██████▌   | 4897/7530 [00:09<00:06, 401.67it/s]Building query-image map:  66%|██████▌   | 4938/7530 [00:09<00:06, 398.66it/s]Building query-image map:  66%|██████▌   | 4978/7530 [00:09<00:06, 394.53it/s]Building query-image map:  67%|██████▋   | 5018/7530 [00:09<00:06, 390.85it/s]Building query-image map:  67%|██████▋   | 5058/7530 [00:09<00:06, 389.86it/s]Building query-image map:  68%|██████▊   | 5100/7530 [00:09<00:06, 397.14it/s]Building query-image map:  68%|██████▊   | 5140/7530 [00:09<00:06, 395.25it/s]Building query-image map:  69%|██████▉   | 5180/7530 [00:09<00:05, 391.72it/s]Building query-image map:  69%|██████▉   | 5223/7530 [00:09<00:05, 400.97it/s]Building query-image map:  70%|██████▉   | 5264/7530 [00:09<00:05, 397.95it/s]Building query-image map:  70%|███████   | 5304/7530 [00:10<00:05, 392.38it/s]Building query-image map:  71%|███████   | 5344/7530 [00:10<00:05, 383.49it/s]Building query-image map:  72%|███████▏  | 5384/7530 [00:10<00:05, 385.36it/s]Building query-image map:  72%|███████▏  | 5424/7530 [00:10<00:05, 386.23it/s]Building query-image map:  73%|███████▎  | 5464/7530 [00:10<00:05, 389.71it/s]Building query-image map:  73%|███████▎  | 5503/7530 [00:10<00:05, 387.69it/s]Building query-image map:  74%|███████▎  | 5543/7530 [00:10<00:05, 388.60it/s]Building query-image map:  74%|███████▍  | 5582/7530 [00:10<00:05, 387.59it/s]Building query-image map:  75%|███████▍  | 5621/7530 [00:10<00:05, 374.62it/s]Building query-image map:  75%|███████▌  | 5659/7530 [00:10<00:04, 374.62it/s]Building query-image map:  76%|███████▌  | 5697/7530 [00:11<00:04, 373.10it/s]Building query-image map:  76%|███████▌  | 5735/7530 [00:11<00:04, 365.36it/s]Building query-image map:  77%|███████▋  | 5772/7530 [00:11<00:04, 358.35it/s]Building query-image map:  77%|███████▋  | 5811/7530 [00:11<00:04, 364.75it/s]Building query-image map:  78%|███████▊  | 5848/7530 [00:11<00:04, 366.23it/s]Building query-image map:  78%|███████▊  | 5885/7530 [00:11<00:04, 363.11it/s]Building query-image map:  79%|███████▊  | 5922/7530 [00:11<00:04, 357.99it/s]Building query-image map:  79%|███████▉  | 5960/7530 [00:11<00:04, 362.86it/s]Building query-image map:  80%|███████▉  | 5997/7530 [00:11<00:04, 360.77it/s]Building query-image map:  80%|████████  | 6034/7530 [00:12<00:04, 359.81it/s]Building query-image map:  81%|████████  | 6070/7530 [00:12<00:04, 354.90it/s]Building query-image map:  81%|████████  | 6107/7530 [00:12<00:03, 358.21it/s]Building query-image map:  82%|████████▏ | 6143/7530 [00:12<00:03, 355.22it/s]Building query-image map:  82%|████████▏ | 6179/7530 [00:12<00:03, 354.94it/s]Building query-image map:  83%|████████▎ | 6217/7530 [00:12<00:03, 359.39it/s]Building query-image map:  83%|████████▎ | 6253/7530 [00:12<00:03, 357.65it/s]Building query-image map:  84%|████████▎ | 6290/7530 [00:12<00:03, 360.21it/s]Building query-image map:  84%|████████▍ | 6327/7530 [00:12<00:03, 361.64it/s]Building query-image map:  85%|████████▍ | 6364/7530 [00:12<00:03, 361.15it/s]Building query-image map:  85%|████████▌ | 6401/7530 [00:13<00:03, 356.45it/s]Building query-image map:  85%|████████▌ | 6437/7530 [00:13<00:03, 356.19it/s]Building query-image map:  86%|████████▌ | 6473/7530 [00:13<00:03, 349.01it/s]Building query-image map:  86%|████████▋ | 6508/7530 [00:13<00:02, 348.78it/s]Building query-image map:  87%|████████▋ | 6543/7530 [00:13<00:02, 343.93it/s]Building query-image map:  87%|████████▋ | 6578/7530 [00:13<00:02, 343.37it/s]Building query-image map:  88%|████████▊ | 6613/7530 [00:13<00:02, 337.23it/s]Building query-image map:  88%|████████▊ | 6647/7530 [00:13<00:02, 334.95it/s]Building query-image map:  89%|████████▊ | 6681/7530 [00:13<00:02, 332.32it/s]Building query-image map:  89%|████████▉ | 6715/7530 [00:13<00:02, 334.27it/s]Building query-image map:  90%|████████▉ | 6751/7530 [00:14<00:02, 341.06it/s]Building query-image map:  90%|█████████ | 6786/7530 [00:14<00:02, 338.21it/s]Building query-image map:  91%|█████████ | 6820/7530 [00:14<00:02, 335.14it/s]Building query-image map:  91%|█████████ | 6854/7530 [00:14<00:02, 334.76it/s]Building query-image map:  91%|█████████▏| 6888/7530 [00:14<00:01, 332.63it/s]Building query-image map:  92%|█████████▏| 6922/7530 [00:14<00:01, 326.23it/s]Building query-image map:  92%|█████████▏| 6957/7530 [00:14<00:01, 331.95it/s]Building query-image map:  93%|█████████▎| 6991/7530 [00:14<00:01, 329.77it/s]Building query-image map:  93%|█████████▎| 7025/7530 [00:14<00:01, 330.50it/s]Building query-image map:  94%|█████████▎| 7059/7530 [00:15<00:01, 332.62it/s]Building query-image map:  94%|█████████▍| 7095/7530 [00:15<00:01, 338.64it/s]Building query-image map:  95%|█████████▍| 7129/7530 [00:15<00:01, 333.88it/s]Building query-image map:  95%|█████████▌| 7163/7530 [00:15<00:01, 329.39it/s]Building query-image map:  96%|█████████▌| 7196/7530 [00:15<00:01, 328.49it/s]Building query-image map:  96%|█████████▌| 7229/7530 [00:16<00:02, 132.00it/s]Building query-image map:  96%|█████████▋| 7263/7530 [00:16<00:01, 161.09it/s]Building query-image map:  97%|█████████▋| 7298/7530 [00:16<00:01, 192.45it/s]Building query-image map:  97%|█████████▋| 7329/7530 [00:16<00:00, 215.25it/s]Building query-image map:  98%|█████████▊| 7364/7530 [00:16<00:00, 243.72it/s]Building query-image map:  98%|█████████▊| 7400/7530 [00:16<00:00, 270.02it/s]Building query-image map:  99%|█████████▊| 7433/7530 [00:16<00:00, 282.74it/s]Building query-image map:  99%|█████████▉| 7466/7530 [00:16<00:00, 289.92it/s]Building query-image map: 100%|█████████▉| 7501/7530 [00:16<00:00, 304.02it/s]Building query-image map: 100%|██████████| 7530/7530 [00:16<00:00, 444.37it/s]
Mapped 5755 total queries to images.
Running inference on 5729 queries...
  0%|          | 0/5729 [00:00<?, ?it/s]  0%|          | 1/5729 [00:02<3:59:29,  2.51s/it]  0%|          | 2/5729 [00:02<2:01:51,  1.28s/it]  0%|          | 3/5729 [00:03<1:23:46,  1.14it/s]  0%|          | 4/5729 [00:03<1:04:11,  1.49it/s]  0%|          | 5/5729 [00:04<54:12,  1.76it/s]    0%|          | 6/5729 [00:04<45:48,  2.08it/s]  0%|          | 7/5729 [00:04<45:37,  2.09it/s]  0%|          | 8/5729 [00:05<40:47,  2.34it/s]  0%|          | 9/5729 [00:05<39:28,  2.41it/s]  0%|          | 10/5729 [00:06<40:39,  2.34it/s]  0%|          | 11/5729 [00:06<39:23,  2.42it/s]  0%|          | 12/5729 [00:06<36:38,  2.60it/s]  0%|          | 13/5729 [00:07<37:10,  2.56it/s]  0%|          | 14/5729 [00:07<36:40,  2.60it/s]  0%|          | 15/5729 [00:07<36:26,  2.61it/s]  0%|          | 16/5729 [00:08<34:17,  2.78it/s]  0%|          | 17/5729 [00:08<35:46,  2.66it/s]  0%|          | 18/5729 [00:08<36:30,  2.61it/s]  0%|          | 19/5729 [00:09<36:41,  2.59it/s]Token indices sequence length is longer than the specified maximum sequence length for this model (81 > 77). Running this sequence through the model will result in indexing errors
  0%|          | 19/5729 [00:09<48:05,  1.98it/s]
Traceback (most recent call last):
  File "/data/danielsohn0827000/uni-dthon-project/test.py", line 120, in <module>
    main()
  File "/data/danielsohn0827000/uni-dthon-project/test.py", line 99, in main
    bbox_xywh = model.predict(img_path, query_text)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/uni-dthon-project/model.py", line 74, in predict
    query_features = self.clip_model.get_text_features(**query_inputs).detach()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/transformers/utils/generic.py", line 809, in wrapper
    return func(*args, **valid_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/transformers/models/clip/modeling_clip.py", line 888, in get_text_features
    text_outputs: BaseModelOutputWithPooling = self.text_model(
                                               ^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/transformers/models/clip/modeling_clip.py", line 603, in forward
    hidden_states = self.embeddings(input_ids=input_ids, position_ids=position_ids)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/danielsohn0827000/anaconda3/lib/python3.12/site-packages/transformers/models/clip/modeling_clip.py", line 237, in forward
    raise ValueError(
ValueError: Sequence length must be less than max_position_embeddings (got `sequence length`: 81 and max_position_embeddings: 77
